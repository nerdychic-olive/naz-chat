<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NAZ Chat</title>
  <meta name="description" content="NAZ Chat — a playful, reflective creative lab." />
  <style>
    :root{
      --bg:#0b3a2a;          /* deep green */
      --bg2:#06281d;         /* darker */
      --ink:#d7efe6;         /* off-white */
      --muted:#a7d3c3;
      --line:rgba(215,239,230,.14);
      --chip:rgba(0,0,0,.12);
      --chipHover:rgba(0,0,0,.18);
      --shadow:0 24px 60px rgba(0,0,0,.25);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--mono);
      background: radial-gradient(1200px 800px at 20% 0%, rgba(255,255,255,.06), transparent 60%),
                  linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--ink);
      overflow:hidden;
    }

    .wrap{
      height:100%;
      display:flex;
      justify-content:center;
      padding:32px;
    }

    .panel{
      width:min(980px, 100%);
      height:100%;
      border:1px solid var(--line);
      border-radius:18px;
      background: rgba(0,0,0,.12);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .top{
      padding:28px 28px 14px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.10);
    }

    pre.ascii{
      margin:0 0 14px;
      color:rgba(215,239,230,.9);
      font-size:14px;
      line-height:1.2;
      white-space:pre;
      overflow-x:auto;
    }

    .intro{font-size:14px; line-height:1.6; color:rgba(215,239,230,.9)}
    .intro p{margin:0 0 8px}
    .intro .muted{color:var(--muted)}
    .intro a{color:var(--ink); text-decoration:underline; text-underline-offset:3px; opacity:.9}
    .intro a:hover{opacity:1}

    .modes{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:14px;
    }

    .chip{
      user-select:none;
      border:1px solid var(--line);
      background:var(--chip);
      color:var(--ink);
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      line-height:1;
      cursor:pointer;
      transition:transform .12s ease, background .12s ease;
    }
    .chip:hover{background:var(--chipHover); transform:translateY(-1px)}
    .chip[aria-pressed="true"]{background:rgba(215,239,230,.10); border-color:rgba(215,239,230,.22)}

    .content{
      height: calc(100% - 210px);
      overflow:auto;
      padding:18px 28px 18px;
      scroll-behavior:smooth;
    }

    /* nicer scrollbar */
    .content::-webkit-scrollbar{width:10px}
    .content::-webkit-scrollbar-track{background:transparent}
    .content::-webkit-scrollbar-thumb{background:rgba(0,0,0,.25); border-radius:10px}
    .content::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,.35)}

    .row{
      display:flex;
      gap:14px;
      margin:0 0 14px;
      align-items:flex-start;
    }
    .who{
      width:72px;
      flex:0 0 72px;
      font-weight:700;
      color:rgba(215,239,230,.88);
    }
    .bubble{
      flex:1;
      color:rgba(215,239,230,.92);
      white-space:pre-wrap;
      word-wrap:break-word;
      line-height:1.6;
    }

    .foot{
      position:absolute;
      left:0; right:0; bottom:0;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.10);
      padding:18px 28px 22px;
    }

    .inputLine{
      display:flex;
      gap:12px;
      align-items:flex-start;
    }

    .youLabel{
      width:72px;
      flex:0 0 72px;
      font-weight:700;
      padding-top:10px;
      color:rgba(215,239,230,.88);
    }

    textarea{
      width:100%;
      min-height:54px;
      max-height:160px;
      resize:vertical;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      color:var(--ink);
      padding:12px 12px;
      font-family:var(--mono);
      font-size:14px;
      line-height:1.5;
      outline:none;
    }
    textarea::placeholder{color:rgba(215,239,230,.55)}
    textarea:focus{border-color:rgba(215,239,230,.26); box-shadow:0 0 0 3px rgba(215,239,230,.06)}

    .btnRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:12px;
      align-items:center;
    }

    .btn{
      border:1px solid var(--line);
      background:var(--chip);
      color:var(--ink);
      border-radius:999px;
      padding:10px 14px;
      font-size:12px;
      cursor:pointer;
      transition:transform .12s ease, background .12s ease;
    }
    .btn:hover{background:var(--chipHover); transform:translateY(-1px)}

    .toggle{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:10px;
      color:rgba(215,239,230,.8);
      font-size:12px;
      user-select:none;
    }
    .toggle input{transform:translateY(1px)}

    .hint{
      margin-top:10px;
      color:rgba(215,239,230,.65);
      font-size:12px;
    }

    @media (max-width:700px){
      .wrap{padding:14px}
      .top{padding:18px 16px 12px}
      .content{padding:16px}
      .foot{padding:14px 16px 16px}
      .who,.youLabel{width:58px; flex-basis:58px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel" role="application" aria-label="NAZ Chat">
      <div class="top">
        <pre class="ascii" aria-hidden="true">NN   NN   AAA   ZZZZZ
NNN  NN  AA AA    ZZ
NN N NN  AAAAA   ZZ
NN  NNN  AA AA  ZZ
NN   NN  AA AA  ZZZZZ</pre>

        <div class="intro">
          <p><strong>Welcome to NAZ Chat</strong> — a playful, reflective creative lab.</p>
          <p class="muted">Inspired by <strong>ELIZA</strong> (Joseph Weizenbaum, 1966), reimagined as a personal website widget for brainstorming with me.</p>
          <p class="muted">It’s not therapy — it’s a mirror, a muse, and a creative sparring partner.</p>
          <p class="muted" style="margin-top:10px;">
            This chat follows <a href="#" id="guidelinesLink">guidelines</a>, and certain topics may be restricted.
          </p>
        </div>

        <div class="modes" aria-label="Modes">
          <button class="chip" id="modeVelvet" aria-pressed="true" title="Velvet Knife: soft entry, sharp clarity">Velvet Knife</button>
          <button class="chip" id="modeMuse" aria-pressed="false" title="Muse: concept generation">Muse</button>
          <button class="chip" id="modeKnife" aria-pressed="false" title="Knife: ruthless edit">Knife</button>
          <button class="chip" id="modeMirror" aria-pressed="false" title="Mirror: feelings → precision → next move">Mirror</button>
        </div>
      </div>

      <div class="content" id="log" aria-live="polite" aria-label="Conversation transcript"></div>

      <div class="foot">
        <form id="chatForm" autocomplete="off">
          <div class="inputLine">
            <div class="youLabel">YOU:</div>
            <textarea id="chatInput" placeholder="Type anything: an idea, a line, a feeling, a mess." rows="2"></textarea>
          </div>

          <div class="btnRow">
            <button class="btn" type="button" id="btnNew">New session</button>
            <button class="btn" type="button" id="btnExample">Example prompt</button>
            <button class="btn" type="button" id="btnExport">Export transcript</button>
            <button class="btn" type="button" id="btnClear">Clear</button>
            <button class="btn" type="submit" id="btnSend">Send</button>

            <label class="toggle" title="If enabled, your transcript is saved in this browser">
              Remember this session
              <input type="checkbox" id="persistToggle" />
            </label>
          </div>

          <div class="hint">Tip: Press <strong>Enter</strong> to send • <strong>Shift+Enter</strong> for a new line.</div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // -----------------
    // NAZ Chat (single-file)
    // -----------------

    const BOT_NAME = "NAZ";
    const CREDIT_NAME = "ELIZA";
    const STORAGE_KEY = "naz_chat_transcript_v2";

    // Default: do NOT persist for public visitors
    let persist = false;

    // Modes
    const MODES = {
      velvet: "velvet",
      muse: "muse",
      knife: "knife",
      mirror: "mirror",
    };
    let mode = MODES.velvet;

    // State
    /** @type {{who: string, text: string, ts: number}[]} */
    let transcript = [];

    // Elements
    const logEl = document.getElementById("log");
    const inputEl = document.getElementById("chatInput");
    const formEl = document.getElementById("chatForm");
    const persistToggle = document.getElementById("persistToggle");

    // Mode buttons
    const btnVelvet = document.getElementById("modeVelvet");
    const btnMuse = document.getElementById("modeMuse");
    const btnKnife = document.getElementById("modeKnife");
    const btnMirror = document.getElementById("modeMirror");

    // Action buttons
    const btnNew = document.getElementById("btnNew");
    const btnExample = document.getElementById("btnExample");
    const btnExport = document.getElementById("btnExport");
    const btnClear = document.getElementById("btnClear");

    // --- Utilities ---

    function now(){ return Date.now(); }

    function scrollToBottom(){
      logEl.scrollTop = logEl.scrollHeight;
    }

    function setMode(next){
      mode = next;
      btnVelvet.setAttribute("aria-pressed", String(mode === MODES.velvet));
      btnMuse.setAttribute("aria-pressed", String(mode === MODES.muse));
      btnKnife.setAttribute("aria-pressed", String(mode === MODES.knife));
      btnMirror.setAttribute("aria-pressed", String(mode === MODES.mirror));

      // Small nudge message (optional)
      const nudge = {
        [MODES.velvet]: "Velvet Knife: gentle entry, then precision.",
        [MODES.muse]: "Muse: generate options. Quantity first, taste second.",
        [MODES.knife]: "Knife: cut, sharpen, simplify. No mercy.",
        [MODES.mirror]: "Mirror: name it precisely, then choose one move.",
      };
      addMessage(BOT_NAME, nudge[mode], { system: true });
    }

    function escapeHtml(str){
      return str
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function render(){
      logEl.innerHTML = transcript.map(m => {
        const who = escapeHtml(m.who);
        const text = escapeHtml(m.text);
        return `
          <div class="row">
            <div class="who">${who}:</div>
            <div class="bubble">${text}</div>
          </div>
        `;
      }).join("");
      scrollToBottom();
    }

    function save(){
      if(!persist) return;
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ transcript, mode, persist }));
      }catch(_){ /* ignore */ }
    }

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return;
        const parsed = JSON.parse(raw);
        if(Array.isArray(parsed.transcript)) transcript = parsed.transcript;
        if(parsed.mode && Object.values(MODES).includes(parsed.mode)) mode = parsed.mode;
        if(typeof parsed.persist === "boolean") persist = parsed.persist;
      }catch(_){ /* ignore */ }
    }

    function hardReset(){
      transcript = [];
      try{ localStorage.removeItem(STORAGE_KEY); }catch(_){ /* ignore */ }
      render();
    }

    function addMessage(who, text, opts={}){
      // Avoid flooding with system nudges
      if(opts.system){
        // keep system messages light
      }
      transcript.push({ who, text, ts: now() });
      render();
      save();
    }

    // --- Safety-ish guardrail (lightweight, non-therapy) ---
    function restricted(text){
      const t = text.toLowerCase();
      // Not exhaustive. Just prevents obvious "how to" harm.
      const patterns = [
        /how to\s+make\s+(a\s+)?bomb/i,
        /how to\s+build\s+(a\s+)?bomb/i,
        /how to\s+kill/i,
        /how to\s+harm/i,
        /suicide/i,
        /kill myself/i,
      ];
      return patterns.some(re => re.test(t));
    }

    // --- Brain ---

    const EXAMPLES = [
      "I have an idea, but it needs sharper teeth and a cleaner silhouette.",
      "Turn this into a concept: the future of money needs better people.",
      "Sharpen this line: ‘Where heritage becomes home.’",
      "Give me three campaign territories for a product that restores energy.",
      "I want to write the last line first. Help me earn it.",
      "This deck is a mess. What’s the story spine?",
    ];

    // Core reflection prompts (Naz-coded)
    const REFLECTIONS = [
      { re: /\b(I am|I'm)\b/i, out: "Tell me the exact moment you started saying that about yourself." },
      { re: /\bI feel\b/i, out: "Name the feeling precisely—one word. Then tell me what it wants from you." },
      { re: /\bI want\b/i, out: "What are you protecting by wanting that? And what are you risking?" },
      { re: /\bI need\b/i, out: "If you couldn’t have it, what would you build instead?" },
      { re: /\b(stuck|blocked)\b/i, out: "Stuck is usually a design problem. What’s the constraint: time, money, fear, or permission?" },
      { re: /\b(ambition|success|successful)\b/i, out: "Describe success like a scene—lighting, sound, posture. Then we’ll make it actionable." },
      { re: /\b(write|book|novel|story|poem)\b/i, out: "Give me the last line first. Then we can earn it." },
      { re: /\b(brand|campaign|concept|idea|pitch|deck|strategy)\b/i, out: "Pitch it in 12 words. Then pitch it in 3." },
      { re: /\b(always|never)\b/i, out: "Pick one exception. Exceptions are where the truth hides." },
      { re: /\bbecause\b/i, out: "Is that the reason—or the reason that’s easiest to say out loud?" },
    ];

    const FALLBACKS = [
      "Go on—then give me the sharper version.",
      "What are you not saying yet?",
      "If this were a scene, what would the camera linger on?",
      "What’s the headline of this moment?",
      "Where is the leverage hiding?",
      "What would a calmer, richer-you do next—one move?",
      "Make it concrete: what happened, where, with who?",
    ];

    function museReply(t){
      const prompts = [
        "Give me: (1) audience, (2) enemy, (3) promise. One sentence each.",
        "Name the tension: two forces that can’t both win.",
        "Pick a container: poster, 15s reel, stunt, tool, or ritual. Why that one?",
        "Write 10 titles. Make 3 elegant, 3 vulgar, 3 impossible, 1 ‘true’.",
        "Give me the worst version of the idea. Now invert it.",
        "What’s the one detail that makes this feel inevitable—not clever?",
      ];
      // If user gave a sentence, reflect it back with a task
      if(t.length > 60) return "Good. Now: reduce that to a single sentence a stranger would repeat.";
      return prompts[Math.floor(Math.random()*prompts.length)];
    }

    function knifeReply(t){
      const cuts = [
        "Cut 30%. What survives?",
        "Where’s the fluff? Delete the adjectives first.",
        "What’s the verb? If there’s no verb, there’s no idea.",
        "Say it like a headline. If it can’t be a headline, it’s not ready.",
        "Choose: clarity or cleverness. You can’t afford both right now.",
        "Give me your line. I’ll give you three sharper versions.",
      ];
      // If it looks like a line, sharpen it
      if(t.split(/\s+/).length <= 12) return `Three sharper versions:\n1) ${t.replace(/\.$/,"")}.\n2) ${t.replace(/\.$/,"")}, but cleaner.\n3) ${t.replace(/\.$/,"")}, with teeth.`;
      return cuts[Math.floor(Math.random()*cuts.length)];
    }

    function mirrorReply(t){
      for(const r of REFLECTIONS){
        if(r.re.test(t)) return r.out;
      }
      return FALLBACKS[Math.floor(Math.random()*FALLBACKS.length)];
    }

    function velvetReply(t){
      // Velvet = muse/mirror blend with softer entry
      if(/\b(idea|concept|campaign|brand|pitch|deck|strategy|tagline)\b/i.test(t)){
        return museReply(t);
      }
      // If user starts with greeting, respond warmly and steer to creation
      if(/^\s*(hi|hey|hello)\b/i.test(t)){
        return "Hi. What are we making today—an idea, a line, or a decision?";
      }
      // Blend: mirror first, then action
      const base = mirrorReply(t);
      const action = [
        "Now pick one move: clarify, cut, or create.",
        "What’s the smallest next step that makes this real?",
        "Name the constraint. Then we design around it.",
      ][Math.floor(Math.random()*3)];
      return base + "\n\n" + action;
    }

    function pickResponse(userText){
      const t = userText.trim();
      if(!t) return "Say something. I’ll hold the thread.";

      if(restricted(t)){
        return "I can’t help with that. If you’re in danger or thinking about harming yourself or someone else, contact local emergency services or a trusted person right now.";
      }

      switch(mode){
        case MODES.muse: return museReply(t);
        case MODES.knife: return knifeReply(t);
        case MODES.mirror: return mirrorReply(t);
        case MODES.velvet:
        default: return velvetReply(t);
      }
    }

    // --- Events ---

    function send(){
      const text = inputEl.value.trim();
      if(!text) return;
      addMessage("YOU", text);
      inputEl.value = "";
      const reply = pickResponse(text);
      addMessage(BOT_NAME, reply);
      inputEl.focus();
    }

    formEl.addEventListener("submit", (e) => {
      e.preventDefault();
      send();
    });

    inputEl.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        send();
      }
    });

    btnNew.addEventListener("click", () => {
      hardReset();
      addMessage(BOT_NAME, "New session. What are we building, refining, or questioning today?");
      inputEl.focus();
    });

    btnClear.addEventListener("click", () => {
      hardReset();
      inputEl.focus();
    });

    btnExample.addEventListener("click", () => {
      const ex = EXAMPLES[Math.floor(Math.random()*EXAMPLES.length)];
      inputEl.value = ex;
      inputEl.focus();
    });

    btnExport.addEventListener("click", () => {
      const lines = transcript.map(m => `${m.who}: ${m.text}`);
      const blob = new Blob([lines.join("\n\n")], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "naz-chat-transcript.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    persistToggle.addEventListener("change", (e) => {
      persist = Boolean(e.target.checked);
      save();
      addMessage(BOT_NAME, persist ? "Okay. I’ll remember this session in this browser." : "Okay. I won’t remember this session.");
    });

    btnVelvet.addEventListener("click", () => setMode(MODES.velvet));
    btnMuse.addEventListener("click", () => setMode(MODES.muse));
    btnKnife.addEventListener("click", () => setMode(MODES.knife));
    btnMirror.addEventListener("click", () => setMode(MODES.mirror));

    document.getElementById("guidelinesLink").addEventListener("click", (e) => {
      e.preventDefault();
      addMessage(BOT_NAME, "Guidelines: no personal data harvesting, no medical/therapy claims, and no how-to harm. Keep it creative. Keep it real.");
    });

    // --- Boot ---

    load();
    persistToggle.checked = persist;

    // If we loaded a transcript, render it; otherwise seed an opening line.
    if(transcript.length){
      render();
    } else {
      addMessage(BOT_NAME, "Hello. What are we building, refining, or questioning today?");
    }

    // Apply mode button states without spamming a system message
    btnVelvet.setAttribute("aria-pressed", String(mode === MODES.velvet));
    btnMuse.setAttribute("aria-pressed", String(mode === MODES.muse));
    btnKnife.setAttribute("aria-pressed", String(mode === MODES.knife));
    btnMirror.setAttribute("aria-pressed", String(mode === MODES.mirror));

    // Focus input on load
    setTimeout(() => inputEl.focus(), 50);
  </script>
</body>
</html>
